#!/bin/bash

# Exit if anything sends non-zero
set -e

# Login to lastpass if we aren't.
if ! lpass status -q; then
    echo "Enter LastPass username:"
    read USERNAME
    lpass login "$USERNAME"
fi

SIDEKIQ_KEY=$(lpass show "Shared-ITIMS-Passwords/Sidekiq Pro Instructions" | grep "^BUNDLE_GEMS" | cut -d'=' -f2)

# Configure Sidekiq pro
bundle config gems.contribsys.com "$SIDEKIQ_KEY"

# Configure NPM github token for mapnik.
NPM_TOKEN=$(lpass show "Shared-ITIMS-Passwords/DLS/github-npm-package-token" --notes)

npm config set //npm.pkg.github.com/:_authToken "$NPM_TOKEN"
npm config set @mapnik:registry https://npm.pkg.github.com
